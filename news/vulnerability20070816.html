<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Mayaa 1.1.11 以前にクロスサイトスクリプティングの脆弱性 - JavaServer Templates &quot;Mayaa&quot;</title>
  <link href="../css/base.css" rel="stylesheet" type="text/css">
  <link href="../css/menu_contents.css" rel="stylesheet" type="text/css">
</head>

<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" class="background">

<div align="center"><img src="../images/topbar.gif" width="760" height="4"></div>

<div align="center">
  <div class="contentslogo">
    <a href="../index.html" id="menu08"><img src="../images/logo.gif" alt="Mayaa JavaServer Template" width="430" height="48"></a><img src="../images/topstripe.gif" width="330" height="48"></div>
  <div class="menunews">
    <a href="../about/index.html" id="menu01"><img src="images/menu_about.gif" width="125" height="55" border="0"></a><img src="images/menu_div.gif" width="1" height="55"><img src="images/menu_news_o.gif" width="126" height="55" border="0"><img src="images/menu_div.gif" width="1" height="55"><a href="../documentation/index.html" id="menu03"><img src="images/menu_doc.gif" alt="Documentation" width="126" height="55"></a><img src="images/menu_div.gif" width="1" height="55"><a href="../downloads/index.html" id="menu04"><img src="images/menu_down.gif" alt="downloads" width="126" height="55"></a><img src="images/menu_div.gif" width="1" height="55"><a href="../subprojects/index.html" id="menu05"><img src="images/menu_subpro.gif" alt="SubProjects" width="126" height="55"></a><img src="images/menu_div.gif" width="1" height="55"><a href="../support/index.html" id="menu06"><img src="images/menu_support.gif" alt="Support" width="126" height="55"></a>
  </div>
</div>


<div class="maincontents">

  <div id="contentsleft">
    <img src="../images/arrow02.gif" align="absmiddle"><a href="../index.html" class="text11px">Top</a>
    <div class="sidemenu"><a href="index.html">News</a></div>
    <div class="sidemenu"><a href="information.html">Information</a></div>
  </div><!-- id="contentsleft" -->

  <div id="contentsright">

    <h1><a id="top" name="top"></a>Mayaa 1.1.11 以前にクロスサイトスクリプティングの脆弱性</h1>

    <div>公開日 2007/08/16<br>更新日 2007/10/26</div>

    <p>Mayaa 1.1.11 以前にはクロスサイトスクリプティングの脆弱性があります。下記の発生条件に合致する場合、下記の対応方法を取ってください。</p>

    <h2>発生条件</h2>

    <p>以下のいずれかの条件に当てはまる場合に攻撃が成功する恐れがあります。</p>

    <ul>
        <li>テンプレートの meta タグで charset の指定をしていない</li>
        <li>テンプレートの meta タグで charset を指定しているが、Web ブラウザが認識できない charset を指定している</li>
    </ul>

    <p>HTTP リクエストのパラメータとして受け取った値をレスポンスに出力する処理がある場合に、テンプレートの文字セットと異なる文字セット (UTF-7 など) を使ってスクリプトを記述し、Web ブラウザの文字セット自動認識機能に誤認させることで任意のスクリプトを実行させることができます。</p>


    <h2>対応方法</h2>

    <p>以下の２つの条件を満たすようテンプレートを修正してください。</p>

    <ul>
        <li>テンプレートの meta タグで charset の指定をする</li>
        <li>charset は Web ブラウザが認識できるものである (<strong>日本語シフト JIS の場合は注意が必要</strong>)</li>
    </ul>


    <h3>注意点</h3>

    <p>一般的な日本語文字セットのうち、正しく認識される記述例は下記の通りです。アルファベットの大文字小文字は区別しません。</p>

    <dl class="list">
        <dt>UTF-8</dt>
        <dd>"UTF-8"</dd>
        <dt>日本語 EUC</dt>
        <dd>"EUC-JP"</dd>
        <dt>日本語 JIS</dt>
        <dd>"ISO-2022-JP"</dd>
        <dt>日本語シフト JIS</dt>
        <dd>"Shift_JIS" (<strong>※</strong>)</dd>
    </dl>

    <p>日本語シフト JIS の場合、日本語 Windows で普通に作成されたテンプレートファイルを利用するには、Mayaa を 1.1.12 にバージョンアップの上、<a href="../documentation/engine_settings.html">エンジン設定</a>で <code>convertCharset</code> パラメータを <code>true</code> に設定し、テンプレートの charset には "<strong>Windows-31J</strong>" を指定してください。この設定をすることで、レスポンスヘッダの Content-Type および HTML の meta タグにある charset には "Shift_JIS" が出力されます。(<code>convertCharset</code> パラメータは Mayaa 1.1.12 で追加されました)</p>
    <p>テンプレートの charset で "Shift_JIS" を利用し、文字化けしない範囲の文字のみを使用している場合は問題ありません。</p>

    <h3>日本語シフト JIS の場合の対処についての簡単な解説</h3>

    <p>Internet Explorer 7 以前には、2007/08/16 時点で "Windows-31J" を認識できないバグがあり、日本語シフト JIS を使うためには "Shift_JIS" を指定する必要があります。しかし、日本語 Windows 上で作成されたファイルを Java で正しく読み込むためには encoding を "Windows-31J" として読み込む必要があります。</p>
    <p>Mayaa は利用しているライブラリの都合上、テンプレートファイルを読み込むときの encoding として、そのテンプレートファイルに記述された charset を利用します (charset が指定されていない場合は "UTF-8" と指定されたものとして扱います)。このため、テンプレートファイルの charset には "Windows-31J" と記述し、レスポンスに出力する段階で "Shift_JIS" にする必要があります。Mayaa 1.1.12 ではこのための機能を追加しました。</p>


    <h2>関連情報</h2>

    <p><a href="http://jvn.jp/jp/JVN38199598/index.html">JVN#38199598  Mayaa におけるクロスサイトスクリプティングの脆弱性</a></p>

    <h2>参考情報</h2>

    <dl class="list">
        <dt>IANA の文字セット名正式登録名称</dt>
        <dd><a href="http://www.iana.org/assignments/character-sets">http://www.iana.org/assignments/character-sets</a></dd>
    </dl>

    <h2>謝辞</h2>

    <p>本脆弱性をご報告くださった株式会社セキュアスカイ・テクノロジー 福森 大喜様に感謝いたします。</p>
    <p>調査、対応にご協力いただきました JPCERT/CC 関係者の皆様に感謝いたします。</p>

    <h2>更新履歴</h2>

    <ul>
        <li>2007/10/26<br>
        日本語EUCの文字セット名がEUC_JPになっていたのをEUC-JPに修正(アンダースコアをダッシュに)</li>
        <li>2007/08/27<br>
        JVNのコンテンツ公開に合わせてリンク追記 (関連情報)<br>
        謝辞追記</li>
        <li>2007/08/16<br>
        公開</li>
    </ul>

  </div><!-- id="contentsright"-->

  <div class="copyrights" align="center">
    <img src="../images/copyrights.gif" alt="Copyright (c) 2004-2008 the Seasar Foundation and others. all rights reserved." width="760" height="20">
  </div>

</div><!-- class="maincontents" -->

</body>
</html>