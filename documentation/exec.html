<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
    <title>Maya : Documentation : 3-3. タグ描画のタイミングでスクリプトを実行する</title>
    <link rel="STYLESHEET" href="./maya.css" type="text/css">
</head>
<body>
<div class="header">
<div>Maya : JavaServer Templates</div>
</div>

<div class="navi">
<a href="./before_render.html">←レンダリング前後にスクリプトを実行する</a>
<a href="./index.html">↑index</a>
<a href="./echo.html">タグの属性のみを置き換える→</a>
</div>

<div class="main">


<h1>3-3. タグ描画のタイミングでスクリプトを実行する</h1>

<p>ループごとに少しだけ準備処理をするなど、タグをレンダリングするタイミングでスクリプトを実行したい場合があるでしょう。その場合には <strong>exec プロセッサ</strong>を使います。</p>

<h2>簡単な例</h2>

<p>ごく簡単なサンプルで実際に使ってみましょう。<code>exec</code> プロセッサでループ変数が偶数か奇数かを判定し、変数 <code>evenodd</code> に格納します。さらに <code>write</code> プロセッサを使ってループ変数の値と判定結果を出力します。</p>

<pre>
exec.html
<div class="file">&lt;html&gt;
&lt;body&gt;
    &lt;div id="loop"&gt;
        &lt;div <strong>id="evenodd"</strong>&gt;&lt;span id="value"&gt;dummy&lt;/span&gt;&lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</div>
exec.maya
<div class="file">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;m:maya xmlns:m="http://maya.seasar.org"&gt;

    &lt;m:for id="loop" init="&#36;{ var i = 1 }"
            test="&#36;{ i &amp;lt; 6 }" after="&#36;{ i += 1 }" /&gt;

    &lt;m:exec <strong>id="evenodd"</strong> replace="false"
            <strong>script="&#36;{ var evenodd = (i % 2 == 0) ? 'even' : 'odd'; }"</strong>&gt;
        &lt;m:doBody /&gt;
    &lt;/m:exec&gt;

    &lt;m:write id="value" value="&#36;{ i + ': ' + evenodd }" /&gt;

&lt;/m:maya&gt;</div></pre>

<p>変数 <code>evenodd</code> は <code>exec</code> プロセッサのボディ内でのみ有効です。<code>id="value"</code> の <code>write</code> プロセッサは <code>doBody</code> の結果 <code>exec</code> プロセッサのボディ内にあると見なせますので、<code>evenodd</code> 変数を参照することができます。</p>
<p>ブラウザで <code><a href="http://localhost:8080/maya/exec.html" target="_blank">http://localhost:8080/maya/exec.html</a></code> にアクセスしてみましょう。</p>

<pre>
実行結果
<div class="file">&lt;html&gt;
&lt;body&gt;
    &lt;div id="evenodd"&gt;1: odd&lt;/div&gt;
    &lt;div id="evenodd"&gt;2: even&lt;/div&gt;
    &lt;div id="evenodd"&gt;3: odd&lt;/div&gt;
    &lt;div id="evenodd"&gt;4: even&lt;/div&gt;
    &lt;div id="evenodd"&gt;5: odd&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</div></pre>

<p>実行結果には、正しく <code>evenodd</code> 変数の内容が出力されました。</p>

<p>このサンプルだけで見ると意味がないように見えるかもしれませんが、たとえば配列の要素や計算結果を変数で定義しなおして、設定ファイルの見通しを良くするような使い方に効果を発揮します。</p>

<p>実用場面を考えてみましょう。request に入っているオブジェクトの深い位置へアクセスするには、<code>object.getProperty().getChildren()[1].getValue()</code> のように長い文でアクセスをすることになってしまいます。JavaScript の機能を使って短縮しても <code>object.property.children[1].value</code> でやはり分かりづらいです。</p>
<p>このようなときに <code>var child = object.property.children[1]</code> と変数宣言すれば、<code>child.value</code>、<code>child.name</code> のように分かりやすくプロパティを参照できます。</p>

</div>

<div class="navi">
<a href="./before_render.html">←レンダリング前後にスクリプトを実行する</a>
<a href="./index.html">↑index</a>
<a href="./echo.html">タグの属性のみを置き換える→</a>
</div>

<div class="footer">
&copy;2004-2005, The Seasar Foundation and the others, all rights reserved.
</div>

</body>
</html>
